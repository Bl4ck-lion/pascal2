---
import Chat from "../components/Chat.astro";

const url = new URL(Astro.request.url);
const data = url.searchParams.get("data");
const jsonData = (() => {
	if (url.pathname === "/Chats" && data) {
		return JSON.parse(data);
	} else {
		const data = `[{
			"latestMessageTimestamp": 1683537000,
			"latestMessage": "uwu owo",
			"username": "TestUser",
			"profilePicture": "https://raw.githubusercontent.com/sonicjhon1/sonicjhon1.github.io/main/09%20SchoolworkList-UI/src/assets/003.png",
			"isPinned": false,
			"isArchived": false
			},
			{
			"latestMessageTimestamp": 1683000000,
			"latestMessage": "omagah",
			"username": "Notes",
			"profilePicture": "https://raw.githubusercontent.com/sonicjhon1/sonicjhon1.github.io/main/09%20SchoolworkList-UI/src/assets/default_profile.png",
			"isPinned": true,
			"isArchived": false
			},
			{
			"latestMessageTimestamp": 1683555000,
			"latestMessage": "This is also archived!",
			"username": "Test B64 1",
			"profilePicture": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII=",
			"isPinned": false,
			"isArchived": true
			},
			{
			"latestMessageTimestamp": 1680000000,
			"latestMessage": "Should work too~",
			"username": "Test B64 2",
			"profilePicture": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAADMElEQVR4nOzVwQnAIBQFQYXff81RUkQCOyDj1YOPnbXWPmeTRef+/3O/OyBjzh3CD95BfqICMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMK0CMO0TAAD//2Anhf4QtqobAAAAAElFTkSuQmCC",
			"isPinned": false,
			"isArchived": false
			},
			{
			"latestMessageTimestamp": 1670555000,
			"latestMessage": "This will have default profile.",
			"username": "<-- Profile",
			"isPinned": false,
			"isArchived": false
			},
			{
			"latestMessageTimestamp": 1000000000,
			"latestMessage": "Placeholder to test scroll",
			"username": "Placeholder",
			"isPinned": true,
			"isArchived": false
			},
			{
			"latestMessageTimestamp": 1000000000,
			"latestMessage": "Placeholder to test scroll",
			"username": "Placeholder",
			"isPinned": true,
			"isArchived": false
			},
			{
			"latestMessageTimestamp": 1000000000,
			"latestMessage": "Placeholder to test scroll",
			"username": "Placeholder",
			"isPinned": true,
			"isArchived": false
			},
			{
			"latestMessageTimestamp": 1000000000,
			"latestMessage": "Placeholder to test scroll",
			"username": "Placeholder",
			"isPinned": true,
			"isArchived": false
			},
			{
			"latestMessageTimestamp": 1000000000,
			"latestMessage": "Placeholder to test scroll",
			"username": "Placeholder",
			"isPinned": true,
			"isArchived": false
			},
			{
			"latestMessageTimestamp": 1000000000,
			"latestMessage": "Placeholder to test scroll",
			"username": "Placeholder",
			"isPinned": true,
			"isArchived": false
			},
			{
			"latestMessageTimestamp": 1000000000,
			"latestMessage": "Placeholder to test scroll",
			"username": "Placeholder",
			"isPinned": true,
			"isArchived": false
			},
			{
			"latestMessageTimestamp": 1000000000,
			"latestMessage": "Placeholder to test scroll",
			"username": "Placeholder",
			"isPinned": true,
			"isArchived": false
			}
		]`;
		return JSON.parse(data);
	}
})();
---

<div class="flex flex-col p-4 max-lg:flex-1 w-full min-w-max max-w-sm max-xl:max-w-xs max-lg:max-w-full">
	<div class="mb-2">
		<input type="text" placeholder="Search" class="input input-bordered w-full px-6 transition-colors bg-base-100 border-[1.5px] hover:border-primary-content focus:border-primary-content hover:bg-base-300 focus:bg-base-300 focus:outline-none" />
	</div>
	<div class="bg-base-200 rounded-md pr-2 overflow-scroll">
		{
			jsonData.map((chatData: any) => (
				<Chat
					latestMessageTimestamp={chatData.latestMessageTimestamp}
					latestMessage={chatData.latestMessage}
					username={chatData.username}
					profilePicture={chatData.profilePicture}
					isPinned={chatData.isPinned}
					isArchived={chatData.isArchived}
				/>
			))
		}
	</div>
</div>
