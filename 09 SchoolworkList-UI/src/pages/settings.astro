---
import TBI from "../components/TBI.astro";
import Toggle from "../components/Toggle.astro";
import Layout from "../layouts/Layout.astro";
---

<Layout title="SWL - Settings">
	<main class="m-auto min-h-[85.75vh] max-w-[80%] p-6 max-md:max-w-full">
		<h1 class="prose-2xl font-bold">Change <span class="text-gradient">Settings</span></h1>
		<p class="instructions prose mb-4">
			Settings are saved to the browser's localstorage, it won't sync to other devices.<br />
		</p>
		<div id="setting-tabs" class="tabs tabs-boxed border-base-content/10 border font-semibold">
			<a id="general" class="tab tab-active">General</a>
			<a id="personalization" class="tab">Personalization</a>
			<a id="backup" class="tab">Backup</a>
		</div>
		<div id="setting-container" class="border-base-content/10 bg-primary-content/80 my-4 rounded-lg border py-6 px-40 max-lg:px-6">
			<div id="general">
				<div class="flex flex-col items-center font-bold">
					<Toggle text="Enable Turbo JS" id="turbo-js" action="handleSettingToggles(this)" checked="" />
					<Toggle text="Use custom Backend server URL" id="custom-backend-url" action="handleSettingToggles(this)" />
					<input
						id="custom-backend-url-text"
						type="text"
						placeholder="Paste custom backend URL here!"
						class="input input-bordered input-primary w-[60%] max-w-4xl font-normal max-lg:w-[100%]"
						disabled
					/>
				</div>
				<main class="m-auto flex max-w-[80%] flex-col items-center p-6 max-md:max-w-full">
					<TBI />
				</main>
			</div>
			<div id="personalization" class="hidden">
				<button class="btn">Personalization</button>
				<button class="btn btn-primary">Button</button>
				<button class="btn btn-secondary">Button</button>
				<button class="btn btn-accent">Button</button>
				<button class="btn btn-ghost">Button</button>
				<button class="btn btn-link">Button</button>
				<main class="m-auto flex max-w-[80%] flex-col items-center p-6 max-md:max-w-full">
					<TBI />
				</main>
			</div>
			<div id="backup" class="hidden">
				<button class="btn">Backup</button>
				<button class="btn btn-primary">Button</button>
				<button class="btn btn-secondary">Button</button>
				<button class="btn btn-accent">Button</button>
				<button class="btn btn-ghost">Button</button>
				<button class="btn btn-link">Button</button>
				<main class="m-auto flex max-w-[80%] flex-col items-center p-6 max-md:max-w-full">
					<TBI />
				</main>
			</div>
			<div id="setting-button" class="flex justify-end max-md:flex-col">
				<button class="btn btn-error m-1">Reset defaults</button>
				<button class="btn btn-primary m-1" onclick="saveSettings()">Save and Apply</button>
			</div>
		</div>
	</main>
</Layout>
<script is:inline>
	var settingsTab = document.getElementById("setting-tabs");
	var activeTab = document.getElementById("setting-tabs").querySelector(".tab-active");
	var settingsContainer = document.getElementById("setting-container");

	function switchSettingsTab(obj) {
		activeTab.classList.toggle("tab-active");
		obj.classList.toggle("tab-active");
		activeTab = obj;
	}

	function switchSettingsContainer(obj) {
		Array.from(settingsContainer.children).forEach((container) => {
			if (container.id == "setting-button") return;
			container.classList.add("hidden");
		});
		settingsContainer.querySelector("#" + obj.id).classList.remove("hidden");
	}

	Array.from(settingsTab.children).forEach((tab) => {
		tab.addEventListener("click", () => {
			if (tab.classList.contains("tab-active")) return;
			switchSettingsTab(tab);
			switchSettingsContainer(tab);
		});
	});
</script>
<script is:inline>
	function handleSettingToggles(elementToggle) {
		switch (elementToggle.id) {
			case "turbo-js":
				break;
			case "custom-backend-url":
				document.getElementById("custom-backend-url-text").disabled = !elementToggle.checked;
				break;
			default:
				console.log("Setting '", elementToggle.id, "' does not exist");
				break;
		}
	}

	function saveSettings() {
		let settings = {
			"turbo-js": document.getElementById("turbo-js").checked,
			"custom-backend-url": document.getElementById("custom-backend-url").checked,
			"custom-backend-url-text": document.getElementById("custom-backend-url-text").value,
		};
		localforage
			.setItem("settings", settings)
			.then(function () {
				return localforage.getItem("settings");
			})
			.then(function (value) {
				console.log(value);
			});
	}
</script>
<style>
	.text-gradient {
		background-image: var(--accent-gradient);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-size: 400%;
		background-position: 0%;
	}
</style>
